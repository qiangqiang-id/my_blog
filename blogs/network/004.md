---
title: 如何理解DNS解析？
date: 2021-11-15
categories: 
 - 网络协议
tags: HTTP
sidebar: 'auto'
---
# DNS解析

**什么是IP地址？**

- IP地址就是每台电脑的地址。
- 每台电脑的IP地址是独一无二的，这样才能保证我们访问到我们想要访问到的电脑。

IP地址的形式：14.215.177.39

**什么是域名？**

- 一串字符，用来映射对应的IP地址。

- 域名是有结构的，是一串用 . 分割的多个词组，最右边的称为“顶级域名”，”顶级域名“的左侧就是”二级域名“，层级关系是向左依次递减。
- 最左边的是主机名，通常用来表示用途，比如”www“ 表示提供万维网服务，”mail“ 表示提供邮件服务，还有像我现在是网站地址就是”blog“开头表示这是一个提供博客服务网站。

域名的形式：www.baidu.com



**DNS解析概念（也称为域名解析）**

因为IP地址为一串数字，非常不友好我们平时的记忆。所以需要一个容易记住名字，来对应到电脑的IP地址，那么就需要使用域名了。

比如 当我们访问百度的时候，假设百度的IP地址为 14.215.177.39。但是我们只要记住 www.baidu.com 这串字符，就能访问到 14.215.177.39 的电脑上去。这中间其实就是**浏览器**做了DNS解析的操作。

举个例子：假如我现在打电话给小明， 但是我忘记的他的电话号，然后翻通讯录查找到了小明。此时小明的电话号码就是电脑的IP地址，小明的名字就是域名。



**DNS解析系统**

DNS 的核心系统是一个三层的树形结构：

这里以百度域名（www.baidu.com）为例：

- 根域名服务器（Root DNS server）： 返回”com“ 的IP地址。
- 顶级域名服务器（Top-level DNS server）：返回“baidu.com”的IP地址。
- 权威域名服务器（Authoritative DNS server）：返回“www.baidu.com”的IP地址。

![DNS](/img/DNS.png)

**解析的步骤：**

假如，你现在访问“www.baidu.com”，就需要进行下面这三次查询。

1. 访问根域名服务器，它会告诉你“com”顶级域名服务器的地址。
2. 访问“com”顶级域名服务器，它再告诉你“baidu.com”域名服务器的地址。
3. 最后访问“baidu.com”域名服务器，就得到了“www.baidu.com”的地址。

解析域名也就是将域名从左至右在**DNS解析系统**的树形结构中以依次查了一遍。最终获得域名下对应的IP地址。



**缓存**

虽然DNS系统遍布全球，服务稳定，但是如果全世界的网民都往这个系统中挤，即使不崩掉速度也会很慢的。这是时候就需要用到**缓存** 了。

- 浏览器自身缓存DNS。

- 像一些大公司会建立的自己的DNS服务器。代理用户的DNS解析。解析拿到IP地址之后会缓存起来。当下一次在请求相同的域名时，会命中DNS代理服务器中的缓存，就不需要请求DNS解析系统。比较知名的DNS解析代理服务器有：Google的 8.8.8.8  ，Microsoft 的 4.2.2.1。
- 操作系统也会对DNS解析结果做缓存。如果DNS解析代理服务器中没找到，就会在操作系统中查找。
- 操作系统还有一个特殊的本地文件，可以用作缓存映射。在 Linux 里是“/etc/hosts”，在 Windows 里是“C:\WINDOWS\system32\drivers\etc\hosts”，可以自行修改IP与域名的映射关系。如果在操作系统的缓存中没有找到，就会在这个文件中查找。



**总结：**  当在浏览器中输入域名后，DNS查找顺序是这样的：

浏览器自身是否有缓存  => 操作系统中是否有缓存 => 本地hosts文件查找是否有缓存 => 查看代理DNS服务器是否有缓存 => 再去**DNS解析系统**去查找。这样就会极大的优化DNS解析的速度。