(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{558:function(_,v,t){"use strict";t.r(v);var r=t(5),s=Object(r.a)({},(function(){var _=this,v=_.$createElement,t=_._self._c||v;return t("ContentSlotsDistributor",{attrs:{"slot-key":_.$parent.slotKey}},[t("p",[t("strong",[_._v("前言:")]),_._v("\n我们都知道，http协议是基于TCP协议的。因为TCP是面向连接的，所以在发起一个请求时，首先会进行网络连接，而连接是TCP所做的事情，这个连接过程就是TCP的"),t("strong",[_._v("三次握手")]),_._v("。当请求发起，服务端并响应之后，为了不占用资源，连接会断开，这个断开过程就是TCP的"),t("strong",[_._v("四次挥手")]),_._v("。")]),_._v(" "),t("h2",{attrs:{id:"tcp状态位"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#tcp状态位"}},[_._v("#")]),_._v(" TCP状态位")]),_._v(" "),t("ul",[t("li",[t("strong",[_._v("SYN")]),_._v("：发起一个连接")]),_._v(" "),t("li",[t("strong",[_._v("ACK")]),_._v("：回复")]),_._v(" "),t("li",[t("strong",[_._v("RST")]),_._v("：重新连接")]),_._v(" "),t("li",[t("strong",[_._v("FIN")]),_._v("：结束连接")])]),_._v(" "),t("h2",{attrs:{id:"tcp状态以及描述表"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#tcp状态以及描述表"}},[_._v("#")]),_._v(" TCP状态以及描述表")]),_._v(" "),t("table",[t("thead",[t("tr",[t("th",[_._v("状态")]),_._v(" "),t("th",[_._v("描述")])])]),_._v(" "),t("tbody",[t("tr",[t("td",[_._v("LISTEN")]),_._v(" "),t("td",[_._v("等待来自远程TCP应用程序的请求")])]),_._v(" "),t("tr",[t("td",[_._v("SYN_SENT")]),_._v(" "),t("td",[_._v("发送连接请求后等地啊来自远程断点的确认。TCP第一次握手后客户端所处的状态")])]),_._v(" "),t("tr",[t("td",[_._v("SYN-RECEIVED")]),_._v(" "),t("td",[_._v("该端点已经接收到连接请求并发送确认。该端点正在等待最终确认。TCP第二次握手后服务端所处的状态")])]),_._v(" "),t("tr",[t("td",[_._v("ESTABLISHED")]),_._v(" "),t("td",[_._v("代表连接已经建立起来了。这是连接数据传输阶段的正常状态")])]),_._v(" "),t("tr",[t("td",[_._v("FIN_WAIT_1")]),_._v(" "),t("td",[_._v("等待来自远程TCP的终止连接请求或终止请求的确认")])]),_._v(" "),t("tr",[t("td",[_._v("FIN_WAIT_2")]),_._v(" "),t("td",[_._v("在此端点发送终止连接请求后，等待来自远程TCP的连接终止请求")])]),_._v(" "),t("tr",[t("td",[_._v("CLOSE_WAIT")]),_._v(" "),t("td",[_._v("该端点已经收到来自远程端点的关闭请求，此TCP正在等待本地应用程序的连接终止请求")])]),_._v(" "),t("tr",[t("td",[_._v("CLOSING")]),_._v(" "),t("td",[_._v("等待来自远程TCP的连接终止请求确认")])]),_._v(" "),t("tr",[t("td",[_._v("LAST_ACK")]),_._v(" "),t("td",[_._v("等待先前发送到远程TCP的连接终止请求的确认")])]),_._v(" "),t("tr",[t("td",[_._v("TIME_WAIT")]),_._v(" "),t("td",[_._v("等待足够的时间来确保远程TCP接收到其连接终止请求的确认")])])])]),_._v(" "),t("h2",{attrs:{id:"三次握手"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#三次握手"}},[_._v("#")]),_._v(" 三次握手")]),_._v(" "),t("p",[t("strong",[_._v("建立连接")])]),_._v(" "),t("ul",[t("li",[_._v("A：你好，我是A，")]),_._v(" "),t("li",[_._v("B：你好A，我是B。")]),_._v(" "),t("li",[_._v("A：你好B")])]),_._v(" "),t("h3",{attrs:{id:"为啥不是两次"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#为啥不是两次"}},[_._v("#")]),_._v(" 为啥不是两次")]),_._v(" "),t("p",[_._v("A发起一个连接请求，B收到连接请求后会回复到A。此时假设A不再次回复B的话，会出现一下几种情况：")]),_._v(" "),t("ul",[t("li",[_._v("A可能不想与B连接")]),_._v(" "),t("li",[_._v("B回复A的请求可能绕路了")]),_._v(" "),t("li",[_._v("A可能已经挂了")])]),_._v(" "),t("h3",{attrs:{id:"为啥不是四次"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#为啥不是四次"}},[_._v("#")]),_._v(" 为啥不是四次")]),_._v(" "),t("p",[_._v("握手的目的就是为了确认双方通信状态与信息。那四次握手可以吗？\n当然可以，400百次都可以，但是三次就够了，多了并无益处。")]),_._v(" "),t("p",[t("strong",[_._v("状态图")])]),_._v(" "),t("img",{attrs:{src:"/img/network/三次握手.jpg",width:"500px",alt:"三次握手"}}),_._v(" "),t("p",[_._v("最开始双方处于 "),t("strong",[_._v("CLOSE")]),_._v(" 状态。然后服务端会监听某一个端口，进入"),t("strong",[_._v("LISTEN")]),_._v("状态。 客户端会主动发起SYN连接，自己进入"),t("strong",[_._v("SYN-SENY")]),_._v(" 状态。\n服务端接受到后，返回"),t("strong",[_._v("SYN")]),_._v(" 和 "),t("strong",[_._v("ACK")]),_._v("，自己进入了"),t("strong",[_._v("SYN-REVD")]),_._v("状态。之后客户端再次发送 "),t("strong",[_._v("ACK")]),_._v(" 给服务端，自己 进入了 "),t("strong",[_._v("ESTABLISHED")]),_._v("状态；服务端收到  "),t("strong",[_._v("ACK")]),_._v(" 也进入了  "),t("strong",[_._v("ESTABLISHED")]),_._v("状态。")]),_._v(" "),t("h2",{attrs:{id:"四次挥手"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#四次挥手"}},[_._v("#")]),_._v(" 四次挥手")]),_._v(" "),t("p",[t("strong",[_._v("断开连接")])]),_._v(" "),t("ul",[t("li",[_._v("A：你好B，这边要断开了，")]),_._v(" "),t("li",[_._v("B：好的A，我知道了，")]),_._v(" "),t("li",[_._v("B：你好A，那我也断开了，拜拜，")]),_._v(" "),t("li",[_._v("A：好的，拜拜")])]),_._v(" "),t("h3",{attrs:{id:"为啥不是三次"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#为啥不是三次"}},[_._v("#")]),_._v(" 为啥不是三次")]),_._v(" "),t("p",[_._v("因为服务端接收客户端的"),t("strong",[_._v("FIN")]),_._v("，不会立即返回"),t("strong",[_._v("FIN")]),_._v("，需要等待服务端所有的报文都发送完毕，才能发送"),t("strong",[_._v("FIN")]),_._v("。所以服务端会先发送发送一个"),t("strong",[_._v("ACK")]),_._v("表示服务端已经接受到客户端的"),t("strong",[_._v("FIN")]),_._v("。\n如果将服务端的"),t("strong",[_._v("ACK")]),_._v("和"),t("strong",[_._v("FIN")]),_._v("合并的话，由于要等待服务端所有的报文发送完毕，等待的时间过长的话，客户端误以为"),t("strong",[_._v("FIN")]),_._v("没有到达服务端，就会不断的重新发送"),t("strong",[_._v("FIN")]),_._v("。")]),_._v(" "),t("p",[t("strong",[_._v("状态图")])]),_._v(" "),t("img",{attrs:{src:"/img/network/四次挥手.jpg",width:"500px",alt:"四次挥手"}}),_._v(" "),t("p",[_._v("最开始双方都处于 "),t("strong",[_._v("ESTABLISHED")]),_._v("状态。 客户端需要断开，向服务端发起一个 "),t("strong",[_._v("FIN")]),_._v(" 请求后，进入 "),t("strong",[_._v("FIN_WAIT_1")]),_._v(" 状态。服务端接受后向客户端确认"),t("strong",[_._v("ACK")]),_._v("，进入了"),t("strong",[_._v("CLOSE_WAIT")]),_._v("状态。客户端接收到后，进入"),t("strong",[_._v("FIN_WAIT2")]),_._v("状态。随后服务器继续向客户端发送"),t("strong",[_._v("FIN")]),_._v("，并进入"),t("strong",[_._v("LAST_ACK")]),_._v("状态。客户端接受到服务端的"),t("strong",[_._v("FIN")]),_._v("后，自己变成了"),t("strong",[_._v("TIME_WAIT")]),_._v("状态，然后发送"),t("strong",[_._v("ACK")]),_._v("给服务器。")]),_._v(" "),t("p",[t("strong",[_._v("注意：")]),_._v(" MSL 表示报文在网络上生存的最大时间，超过这个时间报文就被丢弃。这里是一来一回，所以就是等待 2MSL 时间。在这段时间内如果客户端没有收到服务端的重发请求，那么表示 ACK 成功到达，挥手结束，否则客户端重发 ACK")]),_._v(" "),t("h2",{attrs:{id:"序号的作用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#序号的作用"}},[_._v("#")]),_._v(" 序号的作用")]),_._v(" "),t("p",[_._v("序号的作用就是为了解决乱序问题，不编好号怎么确认哪个应该先来，哪个应该后来呢。另外注意的是 "),t("strong",[_._v("SYN")]),_._v("是需要消耗一个序列号的，回复"),t("strong",[_._v("ACK")]),_._v(" 的序号都要加一。所以有一个规则就是："),t("strong",[_._v("凡是需要对方确认的，一定消耗一个TCP序列号")]),_._v("。")])])}),[],!1,null,null,null);v.default=s.exports}}]);